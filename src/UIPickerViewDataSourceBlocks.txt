// UIPickerViewDataSource Block typedefs

typedef NSInteger (^NumberOfComponentsInPickerViewBlock)(UIPickerView *pickerView);
typedef NSInteger (^PickerViewNumberOfRowsInComponentBlock)(UIPickerView *pickerView, NSInteger component);

#pragma mark - UIPickerViewDataSource Block setter definitions

- (instancetype)setNumberOfComponentsInPickerViewBlock:(NumberOfComponentsInPickerViewBlock)block;
- (instancetype)setPickerViewNumberOfRowsInComponentBlock:(PickerViewNumberOfRowsInComponentBlock)block;

// UIPickerViewDataSource Block keys

static char NumberOfComponentsInPickerViewKey;
static char PickerViewNumberOfRowsInComponentKey;

#pragma mark - UIPickerViewDataSource Block setters

- (instancetype)setNumberOfComponentsInPickerViewBlock:(NumberOfComponentsInPickerViewBlock)block
{
  objc_setAssociatedObject(self, &NumberOfComponentsInPickerViewKey, block, OBJC_ASSOCIATION_COPY);
  return self;
}

- (instancetype)setPickerViewNumberOfRowsInComponentBlock:(PickerViewNumberOfRowsInComponentBlock)block
{
  objc_setAssociatedObject(self, &PickerViewNumberOfRowsInComponentKey, block, OBJC_ASSOCIATION_COPY);
  return self;
}

#pragma mark - UIPickerViewDataSource

- (NSInteger) numberOfComponentsInPickerView:(UIPickerView *)pickerView
{
  return ^(NumberOfComponentsInPickerViewBlock block) {
    return (block) ? block(pickerView) : 0;
  } (objc_getAssociatedObject(self, &NumberOfComponentsInPickerViewKey));
}

- (NSInteger) pickerView:(UIPickerView *)pickerView numberOfRowsInComponent:(NSInteger)component
{
  return ^(PickerViewNumberOfRowsInComponentBlock block) {
    return (block) ? block(pickerView, component) : 0;
  } (objc_getAssociatedObject(self, &PickerViewNumberOfRowsInComponentKey));
}

